<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="doowttam, blog">

        <link rel="alternate"  href="http://doowttam.com/blog/feeds/all.atom.xml" type="application/atom+xml" title="doowttam Full Atom Feed"/>

        <title>misc category // doowttam // blog</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://doowttam.com/blog/theme/css/pure.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img" style="background: none repeat scroll 0% 0% #3D4F5D">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="http://doowttam.com/blog">doowttam</a></h1>
                            <p class="tagline">blog</p>
                                <p class="social">
                                    <a href="https://twitter.com/doowttam">
                                        <i class="fa fa-twitter-square fa-3x"></i>
                                    </a>
                                    <a href="https://github.com/doowttam">
                                        <i class="fa fa-github fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <!-- A wrapper for all the blog posts -->
            <div class="posts">
                <h1 class="content-subhead">
Posts in 'misc'                        &ndash; Page&nbsp;2
                </h1>
                    <section class="post">
                        <header class="post-header">
                            <h3><a class="post-title" href="http://doowttam.com/blog/tweetmachine">TweetMachine</a></h3>
                            <p class="post-meta"><p>TweetMachine started 2 or 3 years ago when I wanted to reuse an old laptop.
For one reason or another (lack of tools, lack of parts, forgetting about it)
it sat on my "open projects" self through 2 moves. Last week, though, it
occured to me that I had acquired the last piece of hardware I needed and
hadn't realized it. So, it was time to finish the project and make room on the
projects shelf.</p>
<p><a href="http://www.flickr.com/photos/doowttam/6199497986/" title="TweetMachine Finished by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6154/6199497986_57509458aa.jpg" height="375" alt="TweetMachine Finished" width="500" /></a></p>
<p>The device is basically a slightly deconstructed laptop in a shadow box frame
running a custom Twitter client. What follows are the details so you can build
your very own TweetMachine!</p>
<h1>Hardware</h1>
<p>First thing, the screen needs to be separated from the bottom half of the
laptop enough so that it can be easily manipulated. In my experience there is
only one main cable connecting the base to the screen and it connects through
one of the hinges. By taking apart the screen first you should be able to see
this.</p>
<p>In the Dell Inspiron I was dealing with there were two metal hinges that ran
along the screen from top to bottom to keep the screen stiff and restrict
movement. Those needed to be removed so that the screen could go back as far
as I needed it to. After the hinges were removed I put the screen back
together.</p>
<p>To suspend the laptop in a way that would work within the shadow box I decided
to mount it to pegboard. This is the piece that took the most time to figure
out. What I settled on was using plumber's strap to make brackets. Each
individual bracket isn't very strong, but by distributing the weight of the
laptop between 6 or 8 of them things were stable.</p>
<p><a href="http://www.flickr.com/photos/doowttam/6199495684/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6141/6199495684_d36003504b.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p><a href="http://www.flickr.com/photos/doowttam/6199496472/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6145/6199496472_1c8069be2b.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p><a href="http://www.flickr.com/photos/doowttam/6198980947/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6156/6198980947_bfc3d8994c.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p>The laptop fit snugly in the frame, but I was concerned about overheating so I
cut a vent with a Dremel and a hole for the power cable. The back board for
the frame also worried me, so I cut out most of the center and left only
enough of a frame to secure the laptop.</p>
<p><a href="http://www.flickr.com/photos/doowttam/6199510160/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6147/6199510160_f87f3eef14.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p><a href="http://www.flickr.com/photos/doowttam/6198994247/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6171/6198994247_4a03db3cb1.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p><a href="http://www.flickr.com/photos/doowttam/6199512492/" title="TweetMachine Build by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6149/6199512492_bb447ce61b.jpg" height="375" alt="TweetMachine Build" width="500" /></a></p>
<p>Originally I had planned to use a nice photo matte to cover up the rough edges
and only reveal the screen. But after putting it together with and without
that set up, it felt less interesting with it. Cara convinced me it looked
cooler without the matte, so I left it just like that.</p>
<h1>Software</h1>
<p>I installed the latest long term release of Ubuntu and configured it to start
without requiring you to log in. (This is normally a bad idea, by the way.) I
then needed to unlock the keyring automatically so that it could connect to
the wifi without you needing to type in your password. (Again, a bad idea
normally.) Next I installed unclutter, which automatically hides the mouse
cursor. I disabled the screensaver among other power management tweaks.
Finally, in power managment, I configured the power button to shut the
computer down (without asking) whenever it was pressed.</p>
<p>The end result is a laptop that will start up, log in, and connect to the wifi
without intervention. Even better, when you press the power button again it'll
shut itself down.</p>
<p><a href="http://www.flickr.com/photos/doowttam/6199498442/" title="TweetMachine Finished by doowttam_, on Flickr"><img src="http://farm7.static.flickr.com/6027/6199498442_772300f529.jpg" height="375" alt="TweetMachine Finished" width="500" /></a></p>
<p>I wanted a twitter client with no branding and a simple but attractive
interface. Twitter's API is pretty easy to work with so I decided to write one
myself. With Adobe Air, I was able to easily make a full screen app with no
window controls.</p>
<p>The app supports following one user's timeline and a pre-specified search. By
left clicking anywhere in the app it'll toggle between the two modes. (The
left mouse button is easily accessible from the back of the device.)</p>
<p><strong>Quick styling note:</strong> I was using pretty light colors as the background for the app. But, once I finished putting it together and put it in my living room I noticed how the terrible viewing angle of the laptop screen washed out the colors. My solution was to bump up the saturation of the blue and purple quite a bit. Looking at it straight on you see really bright colors, but anywhere else in the room you see the colors as I was originally picturing them.</p>
<p>Finally, the last piece was to configure my app to start whenever I logged in.</p>
<p>You can grab the code here: <a href="https://github.com/doowttam/TweetMachine">https://github.com/doowttam/TweetMachine</a> It
won't win any code design awards, but it's simple and runs smoothly.</p>
<p><strong>Quick note about OAuth:</strong> Twitter moved to OAuth recently for user authentication. This is great for users but can be annoying for developers. Luckly though, Twitter allows you to shortcut the OAuth process if you're the developer of the app. For simplicity I went this route and hard-coded the access keys. This does mean, though, that the app can only work with one user's timeline.</p>
<h1>Future Improvements</h1>
<p>I'd love to have more control over the app remotely. So, I'm planning on
running a light webserver and webapp that'll allow anyone connecting to it
within my apartment to tweak the setttings and change the search term. Right
now the search is hard-coded and although it's easy to change, it requires
SSHing into the machine and restarting the app.</p>
<p>I'd also like to have the app expand links and show videos (muted) and images
that people link to. I don't think it'd be too hard and would really increase
the interesting-ness of the appliance.</p></p>
                            <p class="post-meta">// under  &middot; 10-01-2011
                            </p>
                        </header>
                    </section>
                    <section class="post">
                        <header class="post-header">
                            <h3><a class="post-title" href="http://doowttam.com/blog/mysql-benchmarking-with-sysbench">Issues Benchmarking MySQL With Sysbench</a></h3>
                            <p class="post-meta"><p>Benchmarking MySQL can be a tricky task. There are many variables that interact with each other and it can be difficult to run good isolated experiments and get data you can use. I ran into trouble benchmarking with sysbench recently that stumped me at first.
I was upgrading a database server to MySQL 5.1 from MySQL 5.0 in the hopes of getting better concurrency performance from InnoDB. The first step in that upgrade process was to run some benchmarks on 5.0 and 5.1 to make sure we were getting the benefits we were aiming for and not taking any performance hits. I performed an end-to-end application benchmark, a concurrency benchmark, and two standard benchmarks. The standard benchmarks were <a href="http://sysbench.sourceforge.net/docs/">sysbench</a> (read only and read/write) and the <a href="http://sourceforge.net/apps/mediawiki/osdldbt/index.php?title=Main_Page">Database Test Suite’s OLTP test</a>.</p>
<h1>The Mystery</h1>
<p>All of my benchmarks looked great except for the sysbench test. I was getting an order of magnitude better performance from 5.0 than from 5.1. This kind of performance regression was pretty disconcerting and needed to be investigated before we could continue with the upgrade.</p>
<p>The first step was isolating the variables. I got two cloud servers with a base Debian Lenny install and installed MySQL on both. (One server had 5.0, and the other 5.1.) I wanted to be sure that none of the other config our servers normally have could be causing the performance regression. I tweaked the config identically on both servers to give some reasonable values for things like the InnoDB buffer pool size. I then had sysbench create a test table with 1000000 rows. Finally I dumped the table and imported it into the other MySQL server.</p>
<p>The next step was to confirm that the problem still existed in my new isolated setups. The benchmark I used was the following:</p>
<p><code>sysbench --test=oltp --oltp-table-size=1000000 --mysql-db=sysbench --mysql-user=root --max-time=60 --max-requests=0 --num-threads=4 --oltp-read-only=on run</code></p>
<p>Running that on the new setups gave these results:</p>
<h2>Transactions Per Second</h2>
<ul>
<li>MySQL 5.0: 1309.28</li>
<li>MySQL 5.1: 425.23</li>
</ul>
<p>This confirms that after removing all of the variables associated with our setup and our applications the performance regression was still present. MySQL 5.0 was performing more than three times better than 5.1 on this read only benchmark.</p>
<h1>The Investigation</h1>
<p>The first thing to investigate were the MySQL status variables. I noticed that MySQL 5.1 had a really high query cache lowmem prune rate, especially when compared to the insert rate. I checked the same query cache variables in 5.0 and found that the query cache wasn’t being used at all. This was a surprise since the query cache was turned on in both installs and configured in the exact same way.</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">status</span> <span class="k">like</span> <span class="s1">&#39;%Qcache%&#39;</span><span class="p">;</span>
<span class="o">+-------------------------+---------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>           <span class="o">|</span> <span class="n">Value</span>   <span class="o">|</span>
<span class="o">+-------------------------+---------+</span>
<span class="o">|</span> <span class="n">Qcache_free_blocks</span>      <span class="o">|</span> <span class="mi">2549</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_free_memory</span>      <span class="o">|</span> <span class="mi">9036656</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_hits</span>             <span class="o">|</span> <span class="mi">74182</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_inserts</span>          <span class="o">|</span> <span class="mi">298916</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_lowmem_prunes</span>    <span class="o">|</span> <span class="mi">291970</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_not_cached</span>       <span class="o">|</span> <span class="mi">92</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_queries_in_cache</span> <span class="o">|</span> <span class="mi">6946</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_total_blocks</span>     <span class="o">|</span> <span class="mi">16442</span>   <span class="o">|</span>
<span class="o">+-------------------------+---------+</span>
<span class="mi">8</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>


<p>MySQL 5.0</p>
<div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">status</span> <span class="k">like</span> <span class="s1">&#39;%Qcache%&#39;</span><span class="p">;</span>
<span class="o">+-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>           <span class="o">|</span> <span class="n">Value</span>    <span class="o">|</span>
<span class="o">+-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Qcache_free_blocks</span>      <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_free_memory</span>      <span class="o">|</span> <span class="mi">16759744</span> <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_hits</span>             <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_inserts</span>          <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_lowmem_prunes</span>    <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_not_cached</span>       <span class="o">|</span> <span class="mi">1105842</span>  <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_queries_in_cache</span> <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> 
<span class="o">|</span> <span class="n">Qcache_total_blocks</span>     <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span> 
<span class="o">+-------------------------+----------+</span>
<span class="mi">8</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>


<p>You can see that MySQL was pruning almost as many queries from the query cache as it was inserting in 5.1.</p>
<p>As an experiment I turned off the query cache in both installs and ran the benchmarks again. This time I got these results:</p>
<h2>Transactions Per Second</h2>
<ul>
<li>MySQL 5.0: 1305.35</li>
<li>MySQL 5.1: 1313.37</li>
</ul>
<p>It was now pretty clear that I had found the performance problem. It had something to do with a change in the way the query cache operated between 5.0 and 5.1. A quick googling for changes in the query cache between versions didn’t turn anything up, so it was time to dig a bit deeper.</p>
<p>I realized that I didn’t know much about the queries sysbench was running. This can be found out pretty easily by turning on the general log in MySQL. I ran the benchmarks again and checked the logs. I found that sysbench uses 10 different types of queries and that it executes them using prepared statements. Now this time google was able to give me some answers. As of <a href="http://dev.mysql.com/doc/refman/5.1/en/query-cache.html">5.1.17, the query cache</a> can cache prepared statements.</p>
<p>From skimming the general log after running sysbench it was clear that the read only benchmark was a worst case scenario for the query cache. It was a lot of simple, generally non-repeating, selects. This means that there is going to be a high query cache insert rate, but low hit rate (because they’re unlikely to repeat), and because so many are being inserted the cache is going to be constantly pruned.</p>
<p>Determining the value of the query cache is a whole separate problem. Some would argue that you’re better off without it. But, I wasn’t trying to evaluate the query cache, and since our apps don’t rely on prepared statements the results I was getting didn’t give a fair representation of how our app would perform.</p>
<h1>The Takeaway</h1>
<p>It was important to figure out what caused the performance regression. It couldn’t just be ignored, even though the other three benchmarks all agreed with each other. Once I figured out what caused the strange results (prepared statements are cached using the query cache) I could make a decision as to whether or not that was important. If you use a lot of prepared statements in your apps, then this information is very valuable and should be considered in your decision to upgrade.</p>
<p>By setting db-ps-mode to disabled you can tell sysbench not to use prepared statements. Once I determined that this better reflected the actual kinds of selects we used in our apps I could run the benchmarks again without the prepared statements:</p>
<p><code>sysbench --test=oltp --oltp-table-size=1000000 --mysql-db=sysbench --mysql-user=root --max-time=60 --max-requests=0 --num-threads=4 --oltp-read-only=on --db-ps-mode=disable run</code></p></p>
                            <p class="post-meta">// under                                 <a class="post-category" href="http://doowttam.com/blog/tag/benchmarking.html">benchmarking</a>
                                <a class="post-category" href="http://doowttam.com/blog/tag/mysql.html">mysql</a>
 &middot; 12-05-2010
                            </p>
                        </header>
                    </section>
                    <section class="post">
                        <header class="post-header">
                            <h3><a class="post-title" href="http://doowttam.com/blog/first-thoughts-on-dependency-injection">First Thoughts on Dependency Injection</a></h3>
                            <p class="post-meta"><p>I may be a little late to the Dependency Injection (DI) party, but it's something I've been thinking about a lot recently. We're experimenting with writing more isolated unit tests at work and one of the tools we're planning on using is DI.
Here's the basic idea as I see it. When you design software in an object oriented way you end up with an object graph. I define an object graph as the image (mental or otherwise) that defines the relationships between your objects. With DI you take those links between objects and make them more flexible.</p>
<p>For example, let's imagine that object A needs objects B and C to do some task. Object A could just instantiate objects B and C and then use them to perform work, but that means the links between object A and objects B and C are very rigid.</p>
<p>Now, refactor the code so that object A requires objects B and C to be passed in. The links on the object graph are now a little less rigid because as long as an object follows the interface offered by object B it could be passed in instead of B. Object A doesn't care as long as it works the same.</p>
<p>The real value to me is that when testing object A I can be less concerned about objects B and C. For my test I'll assume they work correctly and pass in mocked versions of them that return expected values for their methods. Then I focus on making sure object A works correctly. In a different test I'll test object B. With those two pieces tested I've tested each piece in isolation which is easier to process when writing a test, but I've also tested everything as long as B's interface stays the same.</p>
<p>That's the biggest downside to unit testing in isolation I've seen. You'll also need a functional test that ensures object A and object B interact properly and agree on B's interface.</p>
<p>One of the main criticisms I've seen is that DI is the enemy of encapsulation. Encapsulation is the idea that every object only exposes the things it must to other objects. This criticism feels very valid to me. At the moment I'm giving up that encapsulation for more isolation in testing.</p>
<p>I also like DI for passing in other dependencies. For example, passing in a logging function. Maybe in production you want to write to the syslog. In your tests you may just want to make sure the correct values get sent to the log but you don't want to have your tests check the syslog. One way around this is to have your object take in a logging function and in your tests have that function write to STDOUT or some variable you can check.</p>
<p>While looking around the web on the subject I was surprised to find that it appears to be controversial. Some complain that it's not new idea at all and others that it's actually a bad idea. I was sold on the theory the first time I read about it, but haven't used it a lot in practice. I'm still learning and it's something I'm trying to think about as I write code. It'll be interesting to come back to this post and topic in a few months and see how I'm doing.</p>
<p>Here are a few links to read about the disagreement on DI's usefulness or correctness. The Wikipedia talk page is especially interesting.</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Talk:Dependency_injection">Wikipedia talk page on Dependency Injection</a></li>
<li><a href="http://www.infoq.com/news/2007/12/does-di-pay-off">Does Dependency Injection Pay Off?</a></li>
<li><a href="http://kohari.org/2007/08/15/defending-dependency-injection/">Defending Dependency Injection</a></li>
</ul></p>
                            <p class="post-meta">// under                                 <a class="post-category" href="http://doowttam.com/blog/tag/testing.html">testing</a>
 &middot; 11-20-2010
                            </p>
                        </header>
                    </section>
                    <section class="post">
                        <header class="post-header">
                            <h3><a class="post-title" href="http://doowttam.com/blog/tron-o-lantern">Tron-O-Lantern</a></h3>
                            <p class="post-meta"><p>For Halloween I made a glowing Tron pumpkin.</p></p>
                            <p class="post-meta">// under                                 <a class="post-category" href="http://doowttam.com/blog/tag/arduino.html">arduino</a>
 &middot; 10-30-2010
                            </p>
                        </header>
                    </section>
<div class="pagination-wrapper content-subhead">
    <div class="pagination">
        <div class="pagination-left">
                <a href="http://doowttam.com/blog/category/misc.html"><span>&larr; Newer posts</span></a>
        </div>
        <span>Page 2 / 2</span>
        <div class="pagination-right">
        </div>
    </div>
</div><footer class="footer">
    <p>&copy; Matt Wood &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>            </div>
        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-30574320-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>

</body>
</html>